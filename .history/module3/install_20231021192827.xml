<?xml version="1.0" encoding="utf-8"?>
<modification>
  <code>qwqer</code>
  <name>QwQer Shipping service module</name>
  <version>3.0.0.10</version>
  <author> Alex</author>
  <link>https://t.me/alex_klimenko</link>

  <file path="catalog/model/extension/payment/*.php|catalog/model/checkout/order.php">
       <operation>
         <search regex="true"><![CDATA[/^(.*INSERT.*order_history.*order_status_id.*=.*(\$order_status_id)\s.*)$/mU]]></search>
         <add position="after"><![CDATA[
          
          /*qwqer Module order creation*/
          if (isset($order_status_id) && $order_status_id == (int)$order_status_id && isset($order_id)){
           $complete_statses_array = $this->config->get('config_complete_status');
           if (in_array($order_status_id,$complete_statses_array)){
               $this->load->model('checkout/order');
               $order_info_tmp =  $this->model_checkout_order->getOrder($order_id);
            if (strpos($order_info_tmp["shipping_code"],'qwqer.')!==false){
                $address = array();
                foreach ($order_info_tmp as $key=>$value){
                    if (strpos($key,'shipping_',) !== false){
                        $v = str_replace('shipping_','',$key);
                        $address[$v] = $value;
                    }
                }
                $this->load->model('extension/shipping/qwqer');
                $data_order =  $this->model_extension_shipping_qwqer->generateOrderObject($address);
                $this->model_extension_shipping_qwqer->createOrder($data_order);
            }
           }
         }
         /*!qwqer Module order creation*/
         
         $1
          ]]></add>
        </operation>
  </file>

  <file path="catalog/controller/checkout/success.php">
       <operation>
         <search ><![CDATA[if (isset($this->session->data['order_id'])) {]]></search>
         <add position="after"><![CDATA[
          
          /*qwqer Module additional field saving*/
          if (){


          }
         /*!qwqer Module order creation*/
          ]]></add>
        </operation>
  </file>

</modification>