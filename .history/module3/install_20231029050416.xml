<?xml version="1.0" encoding="utf-8"?>
<modification>
  <code>qwqer</code>
  <name>QwQer Shipping service module</name>
  <version>3.0.0.10</version>
  <author> Alex</author>
  <link>https://t.me/alex_klimenko</link>

  <file path="catalog/model/extension/payment/*.php|catalog/model/checkout/order.php">
       <operation>
         <search regex="true"><![CDATA[/^(.*INSERT.*order_history.*order_status_id.*=.*(\$order_status_id)\s.*)$/mU]]></search>
         <add position="after"><![CDATA[
          
          /*qwqer Module notification on order change*/
                    $complete_statses_array = $this->config->get('config_complete_status');
                    if(isset($order_status_id) && in_array($order_status_id,$complete_statses_array) && isset($order_data["shipping_code"]) && strpos($order_data["shipping_code"],'qwqer.')!==false){
                        $this->load->model('extension/shipping/qwqer');
                        $response = $this->shipping_qwqer->getResponse($order_id);
                        $this->load->language('extension/shipping/qwqer');
                        if (isset($response) && isset($response["message"])){
                            $json['qweqr_status']  = $this->language->get('message_status_order_error');
                            $json['qweqr_message'] = $response["message"];
                        }elseif(isset($response) && isset($response["data"]) && isset($response["data"]['id'])){
                            $json['qweqr_status']  = $this->language->get('message_status_order_success');
                            $json['qweqr_message'] = $this->language->get('message_status_order_id')."id:".$response["data"]['id'];
                        }
                    }
          /*qwqer Module notification on order change*/
         
         $1
          ]]></add>
        </operation>
  </file>

  <file path="catalog/controller/checkout/success.php">
       <operation>
         <search ><![CDATA[if (isset($this->session->data['order_id'])) {]]></search>
         <add position="after"><![CDATA[
          
          /*qwqer Module additional field saving*/
          $this->load->model('extension/shipping/qwqer');
          $this->load->model('account/order');
          $order_info =  $this->session->data;
          $data_order =  $this->model_extension_shipping_qwqer->addOrderData($order_info);
          /*!qwqer Module additional field saving*/
          ]]></add>
        </operation>
  </file>

</modification>